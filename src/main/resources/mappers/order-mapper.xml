<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="phantom.books.finalProject.order.mapper.OrderMapper">

	<!-- 주문 ID로 주문 정보 조회 -->
    <select id="findOrderByOrderId" parameterType="string" resultMap="OrderResultMap">
	    SELECT 
	        o.order_no AS orderNo,
	        o.member_no AS memberNo,
	        o.auth_no AS authNo,
	        o.order_date AS orderDate,
	        o.order_count AS orderCount,
	        o.order_price AS totalPrice,
	        d.user_address AS deliveryAddress,
	        d.user_name AS receiver,
	        b.book_no AS bookNo,
	        b.book_title AS bookTitle,
	        b.book_price AS bookPrice,
	        ol.book_count AS bookCount
	    FROM orders o
	    LEFT JOIN delivery d ON o.order_no = d.order_no
	    LEFT JOIN order_list ol ON o.order_no = ol.order_no
	    LEFT JOIN book b ON ol.book_no = b.book_no
	    WHERE o.order_no = #{orderId}
	</select>
	
	<resultMap id="OrderResultMap" type="OrderDto">
	    <id property="orderNo" column="orderNo" />
	    <result property="memberNo" column="memberNo" />
	    <result property="authNo" column="authNo" />
	    <result property="orderDate" column="orderDate" />
	    <result property="orderCount" column="orderCount" />
	    <result property="totalPrice" column="totalPrice" />
	    <result property="deliveryAddress" column="deliveryAddress" />
	    <result property="receiver" column="receiver" />
	    
	    <collection property="books" ofType="Book">
	        <id property="bookNo" column="bookNo" />
	        <result property="bookTitle" column="bookTitle" />
	        <result property="bookPrice" column="bookPrice" />
	        <result property="bookCount" column="bookCount" />
	    </collection>
	</resultMap>

</mapper>
